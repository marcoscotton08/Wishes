<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Make a Wish</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* ===== Base, layout, and typography (minimal, centered) ===== */
    :root{
      --bg: #ffffff;
      --fg: #0f172a;          /* slate-900 */
      --muted:#475569;        /* slate-600 */
      --border:#e2e8f0;       /* slate-200 */
      --field:#f8fafc;        /* slate-50 */
      --accent:#0f62fe;       /* IBM blue, professional */
      --accent-ink:#ffffff;
      --ok:#16a34a;           /* green-600 */
      --err:#dc2626;          /* red-600 */
      --ring: rgba(15, 98, 254, .18);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b0f18;
        --fg:#e5e7eb;
        --muted:#cbd5e1;
        --border:#1f2937;
        --field:#111826;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .page{
      min-height:100vh;
      display:grid; place-items:center;
      padding:24px;
    }
    .card{
      width:min(680px, 100%);
      margin-inline:auto;
      background:var(--bg);
      border:1px solid var(--border);
      border-radius:14px;
      padding:24px;
      box-shadow: 0 8px 24px rgba(0,0,0,.06);
    }
    h1{ margin:0 0 4px; font-size:clamp(22px, 3.4vw, 28px); font-weight:700; letter-spacing:.2px }
    .sub{ margin:0 0 18px; color:var(--muted); font-size:14px }

    /* ===== Form ===== */
    form{ display:grid; gap:16px; margin-top:6px }
    label{ display:block; font-weight:600; margin-bottom:6px }
    .req::after{ content:" *"; color:var(--accent) }

    input[type="text"], textarea{
      width:100%; border:1px solid var(--border); background:var(--field); color:inherit;
      border-radius:10px; padding:12px 14px; outline:none;
      transition: border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    textarea{ min-height:140px; resize:vertical }
    input:focus, textarea:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--ring);
      background: var(--bg);
    }
    .row{ display:grid; gap:14px }
    .hint{ font-size:12px; color:var(--muted); margin-top:6px }
    .err{ color:var(--err); font-size:13px; margin-top:6px; display:none }
    .ok{ color:var(--ok) }
    .counter{ font-size:12px; color:var(--muted); text-align:right }

    /* Honeypot (hidden) */
    .hp{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden }

    /* Private mode (simple switch) */
    .toggle{
      display:flex; align-items:center; gap:12px; padding:10px 12px; border-radius:10px;
      border:1px solid var(--border); background:var(--field)
    }
    .switch{ position:relative; width:44px; height:24px; border-radius:999px; background:#cbd5e1; cursor:pointer; flex:0 0 auto }
    .switch input{ display:none }
    .knob{ position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:50%; background:#fff; transition:left .16s ease }
    .switch input:checked + .knob{ left:22px }
    @media (prefers-color-scheme: dark){
      .switch{ background:#475569 }
      .knob{ background:#e5e7eb }
    }

    /* Submit button (professional) */
    .submit{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 16px; border-radius:10px; border:1px solid var(--accent);
      background:var(--accent); color:var(--accent-ink); cursor:pointer; font-weight:700;
      transition: filter .12s ease, transform .06s ease;
    }
    .submit:hover{ filter:brightness(1.05) }
    .submit:active{ transform: translateY(1px) }
    .submit:disabled{ opacity:.6; cursor:not-allowed }

    .status{ min-height:22px; font-size:14px; margin-top:4px }

    /* Public preview (visible only when Private mode = off) */
    .preview{
      margin-top:6px; padding:12px; border-radius:10px; border:1px solid var(--border);
      background:var(--field); font-size:14px; display:none;
    }
    .preview h3{ margin:0 0 8px; font-size:15px }
    .fade-in{ animation: fade .18s ease }
    @keyframes fade{ from{opacity:0; transform:translateY(2px)} to{opacity:1; transform:none} }

    .small{ font-size:12px; color:var(--muted) }
    .small a{ color:var(--accent); text-underline-offset:2px }
  </style>
</head>
<body>
  <main class="page">
    <section class="card" aria-labelledby="title">
      <h1 id="title">Make a Wish</h1>
      <p class="sub">Write your wish below. If you enable <strong>Private mode</strong>, your wish
        <em>won’t be shown on the site</em>, but I will still receive it privately.</p>

      <form id="wishForm" novalidate>
        <!-- Honeypot -->
        <div class="hp">
          <label>Leave this field empty <input type="text" name="_gotcha" autocomplete="off"></label>
        </div>

        <div class="row">
          <div>
            <label class="req" for="name">Your name</label>
            <input id="name" name="name" type="text" maxlength="60" placeholder="e.g., Alex" required />
            <div class="counter" id="nameCount">0 / 60</div>
            <div class="err" id="nameErr">Please enter your name (at least 2 characters).</div>
          </div>

          <div>
            <label class="req" for="wish">Your wish</label>
            <textarea id="wish" name="wish" maxlength="500" placeholder="Write your wish here..." required></textarea>
            <div class="counter" id="wishCount">0 / 500</div>
            <div class="err" id="wishErr">Please write a wish (at least 5 characters).</div>
            <div class="hint">Tip: avoid sensitive personal data. Choose “Private mode” if you don’t want a public preview.</div>
          </div>
        </div>

        <div class="toggle" role="group" aria-label="Privacy options">
          <label class="switch" title="Hide public preview on this page">
            <input type="checkbox" id="privateMode" aria-label="Private mode">
            <span class="knob" aria-hidden="true"></span>
          </label>
          <div>
            <div><strong>Private mode</strong></div>
            <div class="small">Hides the on-page preview. Your wish is still submitted privately.</div>
          </div>
        </div>

        <button class="submit" id="submitBtn" type="submit" aria-label="Submit wish">Submit</button>
        <div class="status" id="statusArea" aria-live="polite"></div>

        <div class="preview" id="previewBox" aria-live="polite">
          <h3>Public preview</h3>
          <div id="previewBody"></div>
        </div>
      </form>

      <p class="small" style="margin-top:10px">
        Anti-spam: honeypot + Formspree filtering. By submitting, you agree to our basic handling for wishes.
      </p>
    </section>
  </main>

  <script>
    // ===== DOM refs
    const form = document.getElementById('wishForm');
    const nameI = document.getElementById('name');
    const wishI = document.getElementById('wish');
    const nameErr = document.getElementById('nameErr');
    const wishErr = document.getElementById('wishErr');
    const nameCount = document.getElementById('nameCount');
    const wishCount = document.getElementById('wishCount');
    const privateMode = document.getElementById('privateMode');
    const previewBox = document.getElementById('previewBox');
    const previewBody = document.getElementById('previewBody');
    const statusArea = document.getElementById('statusArea');
    const submitBtn = document.getElementById('submitBtn');

    // ===== Helpers
    const updateCounter = (el, out) => out.textContent = el.value.length + ' / ' + el.maxLength;
    const escapeHtml = (str) => str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    function makePreview(){
      const n = nameI.value.trim();
      const w = wishI.value.trim();
      previewBody.innerHTML =
        `<div><strong>${escapeHtml(n || 'Someone')}</strong> wrote:</div>
         <div style="margin-top:6px; white-space:pre-wrap">${escapeHtml(w)}</div>`;
    }

    // ===== Counters
    nameI.addEventListener('input', ()=>updateCounter(nameI, nameCount));
    wishI.addEventListener('input', ()=>updateCounter(wishI, wishCount));
    updateCounter(nameI, nameCount); updateCounter(wishI, wishCount);

    // ===== Validation
    function validate(){
      let ok = true;
      if(!nameI.value || nameI.value.trim().length < 2){
        nameErr.style.display = 'block'; ok = false;
      } else nameErr.style.display = 'none';

      if(!wishI.value || wishI.value.trim().length < 5){
        wishErr.style.display = 'block'; ok = false;
      } else wishErr.style.display = 'none';

      return ok;
    }

    // ===== Private toggle -> preview visibility
    privateMode.addEventListener('change', ()=>{
      if(privateMode.checked){
        previewBox.style.display='none';
      } else {
        makePreview();
        previewBox.style.display='block';
        previewBox.classList.add('fade-in');
        setTimeout(()=>previewBox.classList.remove('fade-in'), 220);
      }
    });

    // Live preview when not private
    const livePreview = ()=>{
      if(!privateMode.checked && (nameI.value || wishI.value)){
        makePreview();
        previewBox.style.display='block';
      }
    };
    nameI.addEventListener('input', livePreview);
    wishI.addEventListener('input', livePreview);

    // ===== Submit
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!validate()) return;

      if(!privateMode.checked){
        makePreview();
        previewBox.style.display='block';
      } else {
        previewBox.style.display='none';
      }

      submitBtn.disabled = true;
      statusArea.textContent = 'Submitting…';

      const data = new FormData(form);
      data.append('privateMode', privateMode.checked ? 'true' : 'false');

      try{
        const resp = await fetch('https://formspree.io/f/xjkakppn', {
          method:'POST',
          body:data,
          headers:{ 'Accept':'application/json' }
        });

        if(resp.ok){
          statusArea.textContent = 'Wish submitted. Thank you!';
          statusArea.classList.add('ok');
          form.reset();
          updateCounter(nameI, nameCount); updateCounter(wishI, wishCount);
          previewBox.style.display='none';
        }else{
          const txt = await resp.text();
          console.error('Formspree error:', txt);
          statusArea.textContent = 'Something went wrong. Please try again.';
          statusArea.classList.remove('ok');
        }
      }catch(err){
        console.error(err);
        statusArea.textContent = 'Network issue. Please try again.';
        statusArea.classList.remove('ok');
      }finally{
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
